System.register("chunks:///_virtual/CocosCanvas2DAdapter.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var s,e,i,o,a;return{setters:[function(t){s=t.extends,e=t.createForOfIteratorHelperLoose,i=t.createClass},function(t){o=t.cclegacy,a=t.Color}],execute:function(){o._RF.push({},"a6142pkpTxAs6RENe1JvNzI","CocosCanvas2DAdapter",void 0);t("CocosCanvas2DAdapter",function(){function t(){this.g=null,this.width=0,this.height=0,this.state=this.defaultState(),this.stack=[],this.path=[],this.currentSub=null,this.tmpColor=new a,this.textCommands=[],this.textOrder=0}var o=t.prototype;return o.attach=function(t,s,e){this.g=t,this.width=s,this.height=e},o.beginFrame=function(){this.stack.length=0,this.state=this.defaultState(),this.path=[],this.currentSub=null,this.textCommands=[],this.textOrder=0},o.getTextCommands=function(){return this.textCommands},o.save=function(){this.stack.push(s({},this.state,{m:s({},this.state.m)}))},o.restore=function(){var t=this.stack.pop();t&&(this.state=t)},o.translate=function(t,s){this.multiply({a:1,b:0,c:0,d:1,e:t,f:s})},o.rotate=function(t){var s=Math.cos(t),e=Math.sin(t);this.multiply({a:s,b:e,c:-e,d:s,e:0,f:0})},o.scale=function(t,s){this.multiply({a:t,b:0,c:0,d:s,e:0,f:0})},o.beginPath=function(){this.path=[],this.currentSub=null},o.closePath=function(){this.currentSub&&(this.currentSub.closed=!0)},o.moveTo=function(t,s){var e={points:[this.transformToLocal(t,s)],closed:!1};this.path.push(e),this.currentSub=e},o.lineTo=function(t,s){var e=this.transformToLocal(t,s);this.currentSub?this.currentSub.points.push(e):this.moveTo(t,s)},o.arc=function(t,s,e,i,o,a){void 0===a&&(a=!1);var h=2*Math.PI,l=i,n=o;!a&&n<l&&(n+=h),a&&n>l&&(n-=h);var r=n-l;!a&&r<0&&(r+=h),a&&r>0&&(r-=h);for(var u=Math.abs(r),c=Math.max(10,Math.ceil(u/(Math.PI/12))),f=0;f<=c;f++){var d=l+r*(0===c?0:f/c),p=t+Math.cos(d)*e,g=s+Math.sin(d)*e;0===f?this.currentSub?this.lineTo(p,g):this.moveTo(p,g):this.lineTo(p,g)}},o.fill=function(){var t=this.g;if(t)for(var s,i=this.cloneColor(this.parseColor(this.state.fillStyle,this.state.globalAlpha)),o=this.cloneColor(this.parseColor(this.state.shadowColor,.75*this.state.globalAlpha)),a=this.state.shadowBlur>0&&o.a>0,h=e(this.path);!(s=h()).done;){var l=s.value;l.points.length<2||(a&&(t.fillColor=o,this.traceSubPath(l,0,-this.state.shadowOffsetY),t.fill()),t.fillColor=i,this.traceSubPath(l,0,0),t.fill())}},o.stroke=function(){var t=this.g;if(t)for(var s,i=this.cloneColor(this.parseColor(this.state.strokeStyle,this.state.globalAlpha)),o=this.cloneColor(this.parseColor(this.state.shadowColor,.75*this.state.globalAlpha)),a=this.state.shadowBlur>0&&o.a>0,h=e(this.path);!(s=h()).done;){var l=s.value;l.points.length<2||(a&&(t.lineWidth=this.state.lineWidth,t.strokeColor=o,this.traceSubPath(l,0,-this.state.shadowOffsetY),t.stroke()),t.lineWidth=this.state.lineWidth,t.strokeColor=i,this.traceSubPath(l,0,0),t.stroke())}},o.fillRect=function(t,s,e,i){var o=this.rectPoints(t,s,e,i);this.drawPoly(o,!0)},o.strokeRect=function(t,s,e,i){var o=this.rectPoints(t,s,e,i);this.drawPoly(o,!1)},o.fillText=function(t,s,e){var i=this.transformToLocal(s,e);this.textCommands.push({kind:"fill",text:t,x:i.x,y:i.y,color:this.state.fillStyle,alpha:this.state.globalAlpha,font:this.state.font,textAlign:this.state.textAlign,lineWidth:this.state.lineWidth,shadowColor:this.state.shadowColor,shadowBlur:this.state.shadowBlur,shadowOffsetY:this.state.shadowOffsetY,order:this.textOrder++})},o.strokeText=function(t,s,e){var i=this.transformToLocal(s,e);this.textCommands.push({kind:"stroke",text:t,x:i.x,y:i.y,color:this.state.strokeStyle,alpha:this.state.globalAlpha,font:this.state.font,textAlign:this.state.textAlign,lineWidth:this.state.lineWidth,shadowColor:this.state.shadowColor,shadowBlur:this.state.shadowBlur,shadowOffsetY:this.state.shadowOffsetY,order:this.textOrder++})},o.defaultState=function(){return{m:{a:1,b:0,c:0,d:1,e:0,f:0},fillStyle:"#000000",strokeStyle:"#000000",lineWidth:1,globalAlpha:1,shadowColor:"rgba(0,0,0,0)",shadowBlur:0,shadowOffsetY:0,font:"16px sans-serif",textAlign:"left"}},o.multiply=function(t){var s=this.state.m;this.state.m={a:s.a*t.a+s.c*t.b,b:s.b*t.a+s.d*t.b,c:s.a*t.c+s.c*t.d,d:s.b*t.c+s.d*t.d,e:s.a*t.e+s.c*t.f+s.e,f:s.b*t.e+s.d*t.f+s.f}},o.transformToLocal=function(t,s){var e=this.state.m,i=e.a*t+e.c*s+e.e,o=e.b*t+e.d*s+e.f;return{x:i-.5*this.width,y:.5*this.height-o}},o.rectPoints=function(t,s,e,i){return[this.transformToLocal(t,s),this.transformToLocal(t+e,s),this.transformToLocal(t+e,s+i),this.transformToLocal(t,s+i)]},o.drawPoly=function(t,s){var e=this.g;if(e&&!(t.length<2)){var i=this.cloneColor(this.parseColor(this.state.shadowColor,.75*this.state.globalAlpha));if(this.state.shadowBlur>0&&i.a>0){s?e.fillColor=i:(e.lineWidth=this.state.lineWidth,e.strokeColor=i),e.moveTo(t[0].x,t[0].y-this.state.shadowOffsetY);for(var o=1;o<t.length;o++)e.lineTo(t[o].x,t[o].y-this.state.shadowOffsetY);e.close(),s?e.fill():e.stroke()}s?e.fillColor=this.cloneColor(this.parseColor(this.state.fillStyle,this.state.globalAlpha)):(e.lineWidth=this.state.lineWidth,e.strokeColor=this.cloneColor(this.parseColor(this.state.strokeStyle,this.state.globalAlpha))),e.moveTo(t[0].x,t[0].y);for(var a=1;a<t.length;a++)e.lineTo(t[a].x,t[a].y);e.close(),s?e.fill():e.stroke()}},o.parseColor=function(t,s){var e=(t||"").trim(),i=255,o=255,a=255,h=1;if(e.length>0&&"#"===e[0]){var l=e.slice(1);3===l.length&&(l=""+l[0]+l[0]+l[1]+l[1]+l[2]+l[2]),l.length>=6&&(i=parseInt(l.slice(0,2),16)||0,o=parseInt(l.slice(2,4),16)||0,a=parseInt(l.slice(4,6),16)||0,l.length>=8&&(h=(parseInt(l.slice(6,8),16)||255)/255))}else if(/^rgba?\(/i.test(e)){var n,r,u,c,f=e.replace(/[rgba()\s]/gi,"").split(",").map((function(t){return Number(t)}));i=null!=(n=f[0])?n:255,o=null!=(r=f[1])?r:255,a=null!=(u=f[2])?u:255,h=f.length>3&&null!=(c=f[3])?c:1}else if(/^hsla?\(/i.test(e)){var d,p,g,m=e.replace(/[hsla()\s]/gi,"").split(","),b=Number(null!=(d=m[0])?d:0),v=this.percentToUnit(null!=(p=m[1])?p:"100"),C=this.percentToUnit(null!=(g=m[2])?g:"50");h=m.length>3&&Number(m[3])||1;var y=this.hslToRgb(b,v,C);i=y[0],o=y[1],a=y[2]}else"white"===e?i=o=a=255:"black"===e&&(i=o=a=0);return this.tmpColor.set(this.clamp255(i),this.clamp255(o),this.clamp255(a),this.clamp255(Math.round(255*h*s))),this.tmpColor},o.cloneColor=function(t){return new a(t.r,t.g,t.b,t.a)},o.traceSubPath=function(t,s,e){var i=this.g;if(i&&!(t.points.length<2)){i.moveTo(t.points[0].x+s,t.points[0].y+e);for(var o=1;o<t.points.length;o++)i.lineTo(t.points[o].x+s,t.points[o].y+e);t.closed&&i.close()}},o.percentToUnit=function(t){var s=String(t).trim();return s.length>0&&"%"===s[s.length-1]?(Number(s.slice(0,-1))||0)/100:Number(s)||0},o.clamp255=function(t){return Math.max(0,Math.min(255,Math.round(t)))},o.hslToRgb=function(t,s,e){var i=(t%360+360)%360/360;if(s<=0){var o=Math.round(255*e);return[o,o,o]}var a=e<.5?e*(1+s):e+s-e*s,h=2*e-a,l=function(t){var s=t;return s<0&&(s+=1),s>1&&(s-=1),s<1/6?h+6*(a-h)*s:s<.5?a:s<2/3?h+(a-h)*(2/3-s)*6:h};return[Math.round(255*l(i+1/3)),Math.round(255*l(i)),Math.round(255*l(i-1/3))]},i(t,[{key:"fillStyle",get:function(){return this.state.fillStyle},set:function(t){this.state.fillStyle=String(t)}},{key:"strokeStyle",get:function(){return this.state.strokeStyle},set:function(t){this.state.strokeStyle=String(t)}},{key:"lineWidth",get:function(){return this.state.lineWidth},set:function(t){this.state.lineWidth=Number(t)||1}},{key:"globalAlpha",get:function(){return this.state.globalAlpha},set:function(t){this.state.globalAlpha=Math.max(0,Math.min(1,Number(t)))}},{key:"shadowColor",get:function(){return this.state.shadowColor},set:function(t){this.state.shadowColor=String(t)}},{key:"shadowBlur",get:function(){return this.state.shadowBlur},set:function(t){this.state.shadowBlur=Number(t)||0}},{key:"shadowOffsetY",get:function(){return this.state.shadowOffsetY},set:function(t){this.state.shadowOffsetY=Number(t)||0}},{key:"font",get:function(){return this.state.font},set:function(t){this.state.font=String(t)}},{key:"textAlign",get:function(){return this.state.textAlign},set:function(t){this.state.textAlign=t}}]),t}());o._RF.pop()}}}));

System.register("chunks:///_virtual/constants.ts",["cc"],(function(E){var _;return{setters:[function(E){_=E.cclegacy}],execute:function(){_._RF.push({},"37e54gORDNM9KIkERlP/leQ","constants",void 0);E("NINJA_SIZE",30),E("WALL_WIDTH",20),E("BASE_SPEED",.35),E("MAX_SPEED",.85),E("DASH_SPEED_MULT",2.5),E("HORIZONTAL_SPEED",.6),E("GRAVITY",.0015),E("JUMP_VELOCITY",-.4),E("ENERGY_MAX",100),E("MAX_HEALTH",3),E("INVINCIBLE_DURATION",1500),E("OBSTACLE_WIDTH",30),E("OBSTACLE_HEIGHT",40),E("COIN_SIZE",24),E("SHURIKEN_SIZE",34),E("LASER_HEIGHT",10),E("HEART_SIZE",24),E("POWERUP_SIZE",26),E("FEVER_COMBO_THRESHOLD",15),E("FEVER_DURATION",5e3),E("MAGNET_DURATION",8e3);_._RF.pop()}}}));

System.register("chunks:///_virtual/Engine.ts",["cc","./constants.ts"],(function(t){var e,i,a,s,n,h,r,o,d,y,l,f,v,m,x,g,p,c,w,F,D,T;return{setters:[function(t){e=t.cclegacy},function(t){i=t.WALL_WIDTH,a=t.ENERGY_MAX,s=t.MAX_HEALTH,n=t.BASE_SPEED,h=t.NINJA_SIZE,r=t.HORIZONTAL_SPEED,o=t.JUMP_VELOCITY,d=t.FEVER_DURATION,y=t.COIN_SIZE,l=t.HEART_SIZE,f=t.POWERUP_SIZE,v=t.OBSTACLE_WIDTH,m=t.OBSTACLE_HEIGHT,x=t.SHURIKEN_SIZE,g=t.LASER_HEIGHT,p=t.FEVER_COMBO_THRESHOLD,c=t.DASH_SPEED_MULT,w=t.MAX_SPEED,F=t.GRAVITY,D=t.MAGNET_DURATION,T=t.INVINCIBLE_DURATION}],execute:function(){e._RF.push({},"894f9JwFE1J1rrOUlr/o+l5","Engine",void 0);t("GameEngine",function(){function t(t,e){this.state=void 0,this.onGameOver=void 0,this.state=this.getInitialState(t,e)}var e=t.prototype;return e.getInitialState=function(t,e){return{ninja:{x:i,y:e-150,yOffset:0,vx:0,vy:0,side:"left",isDashing:!1,energy:a,health:s,invincibleTimer:0,hasShield:!1,magnetTimer:0},entities:[],particles:[],trail:[],floatingTexts:[],speed:n,score:0,combo:0,comboTimer:0,width:t,height:e,distanceSinceLastSpawn:0,bgOffset:0,status:"menu",shakeIntensity:0,bgHue:220,isPointerDown:!1,pointerDownTime:0,isFever:!1,feverTimer:0}},e.reset=function(){var t=this.state,e=t.width,i=t.height;this.state=this.getInitialState(e,i),this.state.status="playing"},e.resize=function(t,e){this.state.width=t,this.state.height=e,this.state.ninja.y=e-150,0===this.state.ninja.vx&&(this.state.ninja.x="left"===this.state.ninja.side?i:t-i-h)},e.spawnParticles=function(t,e,i,a,s,n){void 0===s&&(s=.2),void 0===n&&(n=2);for(var h=0;h<a;h++){var r=Math.random()*Math.PI*2,o=Math.random()*s;this.state.particles.push({x:t,y:e,vx:Math.cos(r)*o,vy:Math.sin(r)*o,life:1,maxLife:1,color:i,size:Math.random()*n+1})}},e.addFloatingText=function(t,e,i,a,s){void 0===s&&(s=1),this.state.floatingTexts.push({id:Math.random(),text:t,x:e,y:i,life:1,color:a,vy:-.05,scale:s})},e.handlePointerDown=function(){if("playing"===this.state.status){this.state.isPointerDown=!0,this.state.pointerDownTime=0;var t=this.state.ninja;0===t.vx?t.vx="left"===t.side?r:-r:t.vx=-t.vx,t.vy=o;var e=t.x+h/2,i=t.y+t.yOffset+h;this.spawnParticles(e,i,"#D1D5DB",5,.15,2)}},e.handlePointerUp=function(){this.state.isPointerDown=!1,this.state.ninja.isDashing=!1},e.triggerFever=function(){var t=this;this.state.isFever=!0,this.state.feverTimer=d,this.state.shakeIntensity=15,this.addFloatingText("狂热时刻!!!",this.state.width/2,this.state.height/2,"#FDE047",3),this.state.entities.forEach((function(e){"coin"!==e.type&&"heart"!==e.type&&"magnet"!==e.type&&"shield"!==e.type&&(e.type="coin",e.width=y,e.height=y,e.vx=0,e.vy=0,t.spawnParticles(e.x,e.y,"#FDE047",5,.2,2))}))},e.spawnEntities=function(){var t=this.state,e=Math.random(),a=Math.random()>.5?"left":"right";if(t.isFever)for(var s=Math.floor(3*Math.random())+6,n=t.width/2-y/2,r=0;r<s;r++){var o=r<s/2?20*-r:20*(r-s/2);t.entities.push({id:Math.random(),type:"coin",x:Math.max(i,Math.min(t.width-i-y,n+o)),y:-y-30*r,width:y,height:y,rotation:0,vx:0,vy:0,markedForDeletion:!1})}else if(e<.03)t.entities.push({id:Math.random(),type:"heart",x:t.width/2-l/2,y:-l,width:l,height:l,rotation:0,vx:0,vy:.1,markedForDeletion:!1});else if(e<.06&&!t.ninja.magnetTimer)t.entities.push({id:Math.random(),type:"magnet",x:t.width/2-f/2,y:-f,width:f,height:f,rotation:0,vx:0,vy:.1,markedForDeletion:!1});else if(e<.09&&!t.ninja.hasShield)t.entities.push({id:Math.random(),type:"shield",x:t.width/2-f/2,y:-f,width:f,height:f,rotation:0,vx:0,vy:.1,markedForDeletion:!1});else if(e<.25)t.entities.push({id:Math.random(),type:"spike",side:a,x:"left"===a?i:t.width-i-v,y:-m,width:v,height:m,rotation:0,vx:0,vy:0,markedForDeletion:!1});else if(e<.55)for(var d=Math.floor(4*Math.random())+5,p=60+40*Math.random(),c=.4+.3*Math.random(),w=t.width/2-y/2,F=0;F<d;F++)t.entities.push({id:Math.random(),type:"coin",x:w+Math.sin(F*c)*p,y:-y-45*F,width:y,height:y,rotation:0,vx:0,vy:0,markedForDeletion:!1});else if(e<.75)t.entities.push({id:Math.random(),type:"shuriken",x:t.width/2-x/2,y:-x,width:x,height:x,rotation:0,vx:.25*(Math.random()-.5),vy:.15,markedForDeletion:!1});else if(e<.85)t.entities.push({id:Math.random(),type:"missile",x:Math.random()>.5?i+10:t.width-i-40,y:-m,width:20,height:40,rotation:0,vx:0,vy:.1,markedForDeletion:!1});else{var D=2.5*h+Math.random()*h,T=i+10,M=t.width-i-D-10,u=T+Math.random()*(M-T);t.entities.push({id:Math.random(),type:"laser",x:0,y:-g,width:t.width,height:g,rotation:0,vx:0,vy:0,markedForDeletion:!1,gapX:u,gapWidth:D})}},e.update=function(t){if("playing"===this.state.status){var e=this.state,r=e.ninja;r.invincibleTimer>0&&(r.invincibleTimer-=t),r.magnetTimer>0&&(r.magnetTimer-=t),e.isFever?(e.feverTimer-=t,r.energy=a,e.feverTimer<=0&&(e.isFever=!1,e.combo=0,this.addFloatingText("狂热结束",e.width/2,e.height/2,"#FFFFFF",2))):e.combo>=p&&this.triggerFever(),e.isPointerDown?(e.pointerDownTime+=t,e.pointerDownTime>150&&r.energy>0?(r.isDashing=!0,r.energy-=.08*t,r.energy<=0&&(r.isDashing=!1,r.energy=0)):r.isDashing=!1):(r.isDashing=!1,r.energy=Math.min(a,r.energy+.03*t));var o=r.isDashing?e.speed*c:e.speed;e.isFever&&(o=Math.max(o,1.5*w)),e.score+=o*t*.02,e.speed=Math.min(w,n+.05*Math.floor(e.score/200)),e.bgOffset=(e.bgOffset+o*t*.5)%e.height,e.bgHue=(220+.1*e.score)%360,e.shakeIntensity>0&&(e.shakeIntensity-=.01*t,e.shakeIntensity<0&&(e.shakeIntensity=0)),e.comboTimer>0&&!e.isFever&&(e.comboTimer-=t,e.comboTimer<=0&&(e.combo=0)),(0!==r.vx||r.isDashing||Math.random()<.3)&&e.trail.push({x:r.x,y:r.y+r.yOffset,life:1,isDashing:r.isDashing});for(var d=e.trail.length-1;d>=0;d--)e.trail[d].life-=t*(e.trail[d].isDashing?.005:.003),e.trail[d].y+=o*t,e.trail[d].life<=0&&e.trail.splice(d,1);if(r.x+=r.vx*t,r.x<=i?(r.x=i,r.vx=0,r.side="left",this.spawnParticles(i,r.y+r.yOffset+h/2,"#D1D5DB",3,.1,1.5)):r.x>=e.width-i-h&&(r.x=e.width-i-h,r.vx=0,r.side="right",this.spawnParticles(e.width-i,r.y+r.yOffset+h/2,"#D1D5DB",3,.1,1.5)),r.yOffset+=r.vy*t,r.vy+=F*t,r.yOffset>0&&(r.yOffset=0,r.vy=0),0===r.vx&&Math.random()<.15){var y="left"===r.side?i:e.width-i;this.spawnParticles(y,r.y+r.yOffset+h,"#9CA3AF",1,.05,1.5)}e.distanceSinceLastSpawn+=o*t;var l=e.isFever?80:Math.max(150,300-200*(e.speed-n))+100*Math.random();e.distanceSinceLastSpawn>l&&(e.distanceSinceLastSpawn=0,this.spawnEntities());var f={x:r.x+4,y:r.y+r.yOffset+4,width:h-8,height:h-8};r.isDashing&&(f.x-=10,f.y-=10,f.width+=20,f.height+=20);for(var v=e.entities.length-1;v>=0;v--){var m=e.entities[v];if(r.magnetTimer>0&&"coin"===m.type){var x=r.x+h/2-(m.x+m.width/2),g=r.y+r.yOffset+h/2-(m.y+m.height/2),M=Math.sqrt(x*x+g*g);M<300&&(m.vx+=x/M*.005*t,m.vy+=g/M*.005*t)}if("missile"===m.type){var u=r.x+h/2-(m.x+m.width/2);m.vx+=5e-5*u*t,m.vx=Math.max(-.2,Math.min(.2,m.vx)),m.rotation=Math.atan2(m.vy+o,m.vx)-Math.PI/2,Math.random()<.4&&this.spawnParticles(m.x+m.width/2,m.y,"#F97316",1,.05,2)}m.y+=(o+m.vy)*t,m.x+=m.vx*t,"shuriken"===m.type&&(m.rotation+=.01*t),"coin"===m.type&&r.magnetTimer<=0&&(m.rotation+=.005*t),"shuriken"!==m.type&&"missile"!==m.type||(m.x<=i||m.x+m.width>=e.width-i)&&(m.vx*=-1,m.x=Math.max(i,Math.min(m.x,e.width-i-m.width)));var E={x:m.x+4,y:m.y+4,width:m.width-8,height:m.height-8},O=!1;if("laser"===m.type){var I=f.y<m.y+m.height&&f.y+f.height>m.y,k=void 0!==m.gapX&&void 0!==m.gapWidth&&f.x>m.gapX&&f.x+f.width<m.gapX+m.gapWidth;O=I&&!k}else O=f.x<E.x+E.width&&f.x+f.width>E.x&&f.y<E.y+E.height&&f.y+f.height>E.y;if(!m.markedForDeletion&&O)if("coin"===m.type){m.markedForDeletion=!0,e.isFever||(e.combo++,e.comboTimer=2e3);var S=10*Math.min(5,e.combo||1);e.score+=S,this.spawnParticles(m.x+m.width/2,m.y+m.height/2,"#FBBF24",8,.15,2),this.addFloatingText("+"+S,m.x,m.y,"#FBBF24",e.combo>1?1.2:1),e.combo>1&&!e.isFever&&this.addFloatingText(e.combo+"连击!",r.x,r.y+r.yOffset-20,"#38BDF8",1.5)}else if("heart"===m.type)m.markedForDeletion=!0,r.health<s?(r.health++,this.addFloatingText("+1 生命",m.x,m.y,"#10B981",1.2)):(e.score+=50,this.addFloatingText("+50 分",m.x,m.y,"#FBBF24",1.2)),this.spawnParticles(m.x+m.width/2,m.y+m.height/2,"#EF4444",15,.25,3);else if("magnet"===m.type)m.markedForDeletion=!0,r.magnetTimer=D,this.addFloatingText("磁铁!",m.x,m.y,"#A855F7",1.5),this.spawnParticles(m.x+m.width/2,m.y+m.height/2,"#A855F7",20,.3,3);else if("shield"===m.type)m.markedForDeletion=!0,r.hasShield=!0,this.addFloatingText("护盾!",m.x,m.y,"#3B82F6",1.5),this.spawnParticles(m.x+m.width/2,m.y+m.height/2,"#3B82F6",20,.3,3);else if("spike"===m.type||"shuriken"===m.type||"laser"===m.type||"missile"===m.type)if(r.isDashing||e.isFever)m.markedForDeletion=!0,e.score+=30,e.shakeIntensity=4,this.spawnParticles(m.x+(m.width||0)/2,m.y+(m.height||0)/2,"#EF4444",15,.3,3),this.addFloatingText("破!",m.x+(m.width||0)/2,m.y,"#EF4444",1.5);else if(r.invincibleTimer<=0)if(m.markedForDeletion=!0,e.combo=0,r.hasShield)r.hasShield=!1,r.invincibleTimer=500,e.shakeIntensity=5,this.spawnParticles(r.x+h/2,r.y+r.yOffset+h/2,"#3B82F6",30,.5,4),this.addFloatingText("护盾破裂!",r.x,r.y+r.yOffset-20,"#3B82F6",1.5);else{if(r.health--,r.health<=0)return e.status="gameover",e.shakeIntensity=15,this.spawnParticles(r.x+h/2,r.y+r.yOffset+h/2,"#EF4444",40,.6,5),void(this.onGameOver&&this.onGameOver(Math.floor(e.score)));r.invincibleTimer=T,e.shakeIntensity=8,this.spawnParticles(r.x+h/2,r.y+r.yOffset+h/2,"#EF4444",20,.4,3),this.addFloatingText("-1 生命",r.x,r.y+r.yOffset-20,"#EF4444",1.5)}(m.y>e.height||m.markedForDeletion)&&e.entities.splice(v,1)}for(var P=e.particles.length-1;P>=0;P--){var b=e.particles[P];b.x+=b.vx*t,b.y+=b.vy*t,b.life-=.002*t,b.life<=0&&e.particles.splice(P,1)}for(var _=e.floatingTexts.length-1;_>=0;_--){var A=e.floatingTexts[_];A.y+=A.vy*t,A.life-=.0015*t,A.life<=0&&e.floatingTexts.splice(_,1)}}},t}());e._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./NinjaAssaultGame.ts","./NinjaRushPortGame.ts","./CocosCanvas2DAdapter.ts","./Engine.ts","./Renderer.ts","./constants.ts","./types.ts"],(function(){return{setters:[null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/NinjaAssaultGame.ts",["./rollupPluginModLoBabelHelpers.js","cc","./NinjaRushPortGame.ts"],(function(t){var a,n,s,e;return{setters:[function(t){a=t.inheritsLoose},function(t){n=t.cclegacy,s=t._decorator},function(t){e=t.NinjaRushPortGame}],execute:function(){var u;n._RF.push({},"0a9ce1SPXFOf7z/LyOt7zq3","NinjaAssaultGame",void 0);var i=s.ccclass;t("NinjaAssaultGame",i("NinjaAssaultGame")(u=function(t){function n(){return t.apply(this,arguments)||this}return a(n,t),n}(e))||u);n._RF.pop()}}}));

System.register("chunks:///_virtual/NinjaRushPortGame.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Engine.ts","./constants.ts","./CocosCanvas2DAdapter.ts","./Renderer.ts"],(function(t){var e,i,s,n,a,h,o,r,l,c,u,f,d,v,p,g,y,m,T,x,b,w,S,R,L,C,E,M,W;return{setters:[function(t){e=t.inheritsLoose,i=t.createForOfIteratorHelperLoose,s=t.extends},function(t){n=t.cclegacy,a=t._decorator,h=t.UITransform,o=t.Node,r=t.Layers,l=t.Graphics,c=t.HorizontalTextAlignment,u=t.VerticalTextAlignment,f=t.Label,d=t.Color,v=t.input,p=t.Input,g=t.KeyCode,y=t.sys,m=t.view,T=t.LabelOutline,x=t.Vec3,b=t.Component},function(t){w=t.GameEngine},function(t){S=t.WALL_WIDTH,R=t.NINJA_SIZE,L=t.ENERGY_MAX,C=t.MAX_HEALTH,E=t.FEVER_COMBO_THRESHOLD},function(t){M=t.CocosCanvas2DAdapter},function(t){W=t.GameRenderer}],execute:function(){var H;n._RF.push({},"3fa27NYdWBHyKMfBrWiX6L3","NinjaRushPortGame",void 0);var N=a.ccclass;t("NinjaRushPortGame",N("NinjaRushPortGame")(H=function(t){function n(){for(var e,i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];return(e=t.call.apply(t,[this].concat(s))||this).canvasTf=null,e.drawNode=null,e.uiTextRoot=null,e.g=null,e.titleLabel=null,e.subLabel=null,e.primaryBtnLabel=null,e.secondaryBtnLabel=null,e.tertiaryBtnLabel=null,e.scoreLabel=null,e.hudLeftLabel=null,e.hudRightLabel=null,e.centerBannerLabel=null,e.engine=null,e.canvasAdapter=null,e.sourceRenderer=null,e.bestScore=0,e.sourceTextPool=[],e.screenState="menu",e.baseVirtualW=390,e.canvasW=390,e.canvasH=844,e.halfW=195,e.halfH=422,e.displayW=720,e.displayH=1280,e.activeButtons=[],e.colorCache={},e.tmpColor=new d,e.tmpPoint=new x,e.bestScoreKey="ninja-rush-port-best-score",e.suppressMouseUntil=0,e}e(n,t);var a=n.prototype;return a.onLoad=function(){var t=this;this.canvasTf=this.node.getComponent(h)||this.node.addComponent(h),this.createLayers(),this.createLabels(),this.syncCanvasSize(!0),this.engine=new w(this.canvasW,this.canvasH),this.canvasAdapter=new M,this.sourceRenderer=new W(this.canvasAdapter),this.screenState="menu",this.bestScore=this.loadBestScore(),this.engine.onGameOver=function(e){t.bestScore=Math.max(t.bestScore,e),t.saveBestScore(t.bestScore),t.screenState="gameover"},this.bindInput(),this.render()},a.onDestroy=function(){this.unbindInput()},a.update=function(t){if(this.syncCanvasSize(!1),this.engine){if("playing"===this.screenState&&"playing"===this.engine.state.status){var e=Math.max(0,1e3*t);e>0&&e<100&&this.engine.update(e)}this.render()}},a.createLayers=function(){this.drawNode=new o("NinjaRushPortDraw"),this.drawNode.layer=r.Enum.UI_2D,this.node.addChild(this.drawNode),this.drawNode.setPosition(0,0,0);var t=this.drawNode.addComponent(h);t.setAnchorPoint(.5,.5),t.setContentSize(this.canvasW,this.canvasH),this.g=this.drawNode.addComponent(l),this.uiTextRoot=new o("NinjaRushPortText"),this.uiTextRoot.layer=r.Enum.UI_2D,this.node.addChild(this.uiTextRoot),this.uiTextRoot.setPosition(0,0,0);var e=this.uiTextRoot.addComponent(h);e.setAnchorPoint(.5,.5),e.setContentSize(this.canvasW,this.canvasH)},a.createLabels=function(){this.titleLabel=this.newLabel("Title",40,c.CENTER,u.CENTER),this.subLabel=this.newLabel("Sub",18,c.CENTER,u.CENTER),this.primaryBtnLabel=this.newLabel("PrimaryBtn",22,c.CENTER,u.CENTER),this.secondaryBtnLabel=this.newLabel("SecondaryBtn",18,c.CENTER,u.CENTER),this.tertiaryBtnLabel=this.newLabel("TertiaryBtn",18,c.CENTER,u.CENTER),this.scoreLabel=this.newLabel("Score",30,c.CENTER,u.TOP),this.hudLeftLabel=this.newLabel("HudLeft",14,c.LEFT,u.TOP),this.hudRightLabel=this.newLabel("HudRight",14,c.RIGHT,u.TOP),this.centerBannerLabel=this.newLabel("CenterBanner",24,c.CENTER,u.CENTER)},a.newLabel=function(t,e,i,s){var n=new o(t);n.layer=r.Enum.UI_2D,this.uiTextRoot.addChild(n),n.setPosition(0,0,0);var a=n.addComponent(h);a.setAnchorPoint(.5,.5),a.setContentSize(300,80);var l=n.addComponent(f);return l.useSystemFont=!0,l.fontSize=e,l.lineHeight=Math.round(1.25*e),l.horizontalAlign=i,l.verticalAlign=s,l.color=new d(255,255,255,255),l.string="",l},a.bindInput=function(){v.on(p.EventType.MOUSE_DOWN,this.onMouseDown,this),v.on(p.EventType.MOUSE_UP,this.onMouseUp,this),v.on(p.EventType.TOUCH_START,this.onTouchStart,this),v.on(p.EventType.TOUCH_END,this.onTouchEnd,this),v.on(p.EventType.TOUCH_CANCEL,this.onTouchEnd,this),v.on(p.EventType.KEY_DOWN,this.onKeyDown,this)},a.unbindInput=function(){v.off(p.EventType.MOUSE_DOWN,this.onMouseDown,this),v.off(p.EventType.MOUSE_UP,this.onMouseUp,this),v.off(p.EventType.TOUCH_START,this.onTouchStart,this),v.off(p.EventType.TOUCH_END,this.onTouchEnd,this),v.off(p.EventType.TOUCH_CANCEL,this.onTouchEnd,this),v.off(p.EventType.KEY_DOWN,this.onKeyDown,this)},a.onKeyDown=function(t){this.engine&&(t.keyCode===g.SPACE||t.keyCode===g.ENTER?("menu"===this.screenState||"gameover"===this.screenState)&&this.startGame():t.keyCode===g.ESCAPE&&"gameover"===this.screenState&&this.goHome())},a.onMouseDown=function(t){if(!("undefined"!=typeof performance&&performance.now()<this.suppressMouseUntil)){var e=t.getUILocation();this.handlePointerDownAt(e.x,e.y)}},a.onMouseUp=function(t){"undefined"!=typeof performance&&performance.now()<this.suppressMouseUntil||this.handlePointerUp()},a.onTouchStart=function(t){"undefined"!=typeof performance&&(this.suppressMouseUntil=performance.now()+360);var e=t.getUILocation();this.handlePointerDownAt(e.x,e.y)},a.onTouchEnd=function(t){this.handlePointerUp()},a.handlePointerDownAt=function(t,e){if(this.engine){for(var s,n=this.toSourcePoint(t,e),a=i(this.activeButtons);!(s=a()).done;){var h=s.value;if(n.x>=h.x&&n.x<=h.x+h.w&&n.y>=h.y&&n.y<=h.y+h.h)return void("start"===h.id||"restart"===h.id?this.startGame():"home"===h.id&&this.goHome())}"playing"===this.screenState&&this.engine.handlePointerDown()}},a.handlePointerUp=function(){this.engine&&"playing"===this.screenState&&this.engine.handlePointerUp()},a.startGame=function(){this.engine&&(this.engine.reset(),this.screenState="playing")},a.loadBestScore=function(){try{var t=y.localStorage.getItem(this.bestScoreKey),e=t?Number(t):0;return!Number.isFinite(e)||e<0?0:Math.floor(e)}catch(t){return 0}},a.saveBestScore=function(t){try{y.localStorage.setItem(this.bestScoreKey,""+Math.max(0,Math.floor(t)))}catch(t){}},a.goHome=function(){this.screenState="menu"},a.syncCanvasSize=function(t){if(this.canvasTf){var e=Math.max(1,Math.round(this.canvasTf.contentSize.width)),i=Math.max(1,Math.round(this.canvasTf.contentSize.height)),s=this.baseVirtualW,n=s*i/e;if(t||e!==this.displayW||i!==this.displayH){this.displayW=e,this.displayH=i,this.canvasW=s,this.canvasH=Math.max(640,n),this.halfW=.5*this.canvasW,this.halfH=.5*this.canvasH;for(var a=this.displayW/this.canvasW,o=this.displayH/this.canvasH,r=0,l=[this.drawNode,this.uiTextRoot];r<l.length;r++){var c=l[r],u=null==c?void 0:c.getComponent(h);u&&u.setContentSize(this.canvasW,this.canvasH),c&&c.setScale(a,o,1)}this.engine&&this.engine.resize(this.canvasW,this.canvasH)}}},a.toSourcePoint=function(t,e){var i,s=null==(i=this.drawNode)?void 0:i.getComponent(h);if(s){this.tmpPoint.set(t,e,0);var n=s.convertToNodeSpaceAR(this.tmpPoint);return{x:n.x+this.halfW,y:this.halfH-n.y}}var a=m.getVisibleSize(),o=(t-.5*a.width)*(this.canvasW/Math.max(1,a.width)),r=(e-.5*a.height)*(this.canvasH/Math.max(1,a.height));return{x:o+this.halfW,y:this.halfH-r}},a.sx=function(t){return t-this.halfW},a.sy=function(t){return this.halfH-t},a.fill=function(t,e,i,s,n){void 0===n&&(n=255),this.tmpColor.set(e,i,s,n),t.fillColor=this.tmpColor},a.stroke=function(t,e,i,s,n){void 0===n&&(n=255),this.tmpColor.set(e,i,s,n),t.strokeColor=this.tmpColor},a.cssColor=function(t,e){void 0===e&&(e=1);var i=t+"|"+e,s=this.colorCache[i];if(s)return s;var n=(t||"").trim(),a=255,h=255,o=255,r=1;if(n.length>0&&"#"===n[0]){var l=n.slice(1);3===l.length&&(l=""+l[0]+l[0]+l[1]+l[1]+l[2]+l[2]),l.length>=6&&(a=parseInt(l.slice(0,2),16)||0,h=parseInt(l.slice(2,4),16)||0,o=parseInt(l.slice(4,6),16)||0,l.length>=8&&(r=(parseInt(l.slice(6,8),16)||255)/255))}else if(/^rgba?\(/i.test(n)){var c,u,f,v,p=n.replace(/[rgba()\s]/gi,"").split(",").map((function(t){return Number(t)}));a=null!=(c=p[0])?c:255,h=null!=(u=p[1])?u:255,o=null!=(f=p[2])?f:255,r=p.length>3&&null!=(v=p[3])?v:1}else if(/^hsla?\(/i.test(n)){var g,y,m,T=n.replace(/[hsla()\s]/gi,"").split(","),x=Number(null!=(g=T[0])?g:0),b=this.percentToUnit(null!=(y=T[1])?y:"100"),w=this.percentToUnit(null!=(m=T[2])?m:"50");r=T.length>3&&Number(T[3])||1;var S=this.hslToRgb(x,b,w);a=S[0],h=S[1],o=S[2]}else"white"===n?a=h=o=255:"black"===n&&(a=h=o=0);var R=new d(this.clamp255(a),this.clamp255(h),this.clamp255(o),this.clamp255(Math.round(255*r*e)));return this.colorCache[i]=R,R},a.percentToUnit=function(t){var e=String(t).trim();return e.length>0&&"%"===e[e.length-1]?(Number(e.slice(0,-1))||0)/100:Number(e)||0},a.hslToRgb=function(t,e,i){var s=(t%360+360)%360/360;if(e<=0){var n=Math.round(255*i);return[n,n,n]}var a=i<.5?i*(1+e):i+e-i*e,h=2*i-a,o=function(t){var e=t;return e<0&&(e+=1),e>1&&(e-=1),e<1/6?h+6*(a-h)*e:e<.5?a:e<2/3?h+(a-h)*(2/3-e)*6:h};return[Math.round(255*o(s+1/3)),Math.round(255*o(s)),Math.round(255*o(s-1/3))]},a.clamp255=function(t){return Math.max(0,Math.min(255,Math.round(t)))},a.render=function(){var t=this.g,e=this.engine;if(t&&e){var i=e.state;this.activeButtons=[],t.clear(),this.canvasAdapter&&this.sourceRenderer?(this.canvasAdapter.attach(t,this.canvasW,this.canvasH),this.canvasAdapter.beginFrame(),this.sourceRenderer.draw(i),"playing"===this.screenState?this.renderSourceTextCommands(this.canvasAdapter.getTextCommands()):this.clearSourceTextPool()):(this.drawBackground(t,i),this.drawEntities(t,i),this.drawNinja(t,i),this.drawUiBars(t,i)),this.updateLabels(i,this.screenState),"menu"===this.screenState&&this.drawMenuOverlay(t,i),"gameover"===this.screenState&&this.drawGameOverOverlay(t,i)}},a.renderSourceTextCommands=function(t){for(var e,s=0,n=i(t);!(e=n()).done;){var a=e.value,h=this.fontSizeFromCss(a.font);if(a.shadowBlur>0){var o=this.getSourceTextLabel(s++);this.applyTextToLabel(o,a,h,!0),o.node.setSiblingIndex(s-1)}var r=this.getSourceTextLabel(s++);this.applyTextToLabel(r,a,h,!1),r.node.setSiblingIndex(s-1)}for(var l=s;l<this.sourceTextPool.length;l++){var c=this.sourceTextPool[l];c.string="",this.upsertOutline(c,null,0)}},a.applyTextToLabel=function(t,e,i,s){var n=t.node.getComponent(h);if(n){n.setContentSize(this.canvasW,Math.max(40,Math.round(1.8*i)));var a=0;"center"===e.textAlign?a=.5:"right"!==e.textAlign&&"end"!==e.textAlign||(a=1),n.setAnchorPoint(a,1)}if(t.node.setPosition(e.x,e.y+.8*i+(s?-e.shadowOffsetY:0),0),t.string=e.text,t.fontSize=i,t.lineHeight=Math.round(1.2*i),"center"===e.textAlign?t.horizontalAlign=c.CENTER:"right"===e.textAlign||"end"===e.textAlign?t.horizontalAlign=c.RIGHT:t.horizontalAlign=c.LEFT,t.verticalAlign=u.TOP,s)return t.color=this.cssColor(e.shadowColor,.8*e.alpha),void this.upsertOutline(t,null,0);"stroke"===e.kind?(t.color=new d(255,255,255,0),this.upsertOutline(t,this.cssColor(e.color,e.alpha),e.lineWidth)):(t.color=this.cssColor(e.color,e.alpha),this.upsertOutline(t,null,0))},a.getSourceTextLabel=function(t){for(;this.sourceTextPool.length<=t;){var e=this.newLabel("SourceText"+this.sourceTextPool.length,18,c.LEFT,u.CENTER);this.sourceTextPool.push(e)}return this.sourceTextPool[t]},a.upsertOutline=function(t,e,i){var s=t.getComponent(T);!e||i<=0?s&&(s.enabled=!1):(s||(s=t.addComponent(T)),s.enabled=!0,s.color=e,s.width=Math.max(1,Math.min(8,Math.round(i))))},a.clearSourceTextPool=function(){for(var t=0;t<this.sourceTextPool.length;t++){var e=this.sourceTextPool[t];e.string="",this.upsertOutline(e,null,0)}},a.fontSizeFromCss=function(t){var e=/(\d+(?:\.\d+)?)px/i.exec(t||"");if(!e)return 18;var i=Number(e[1])||18;return Math.max(10,Math.min(72,Math.round(i)))},a.drawBackground=function(t,e){var i=.5*Math.sin(.01*e.score)+.5,s=e.isFever?[80,10,70]:[10,14,26],n=e.isFever?[50,18,80]:[8,8,14];this.fill(t,n[0],n[1],n[2],255),t.rect(-this.halfW,-this.halfH,this.canvasW,this.canvasH),t.fill(),this.fill(t,s[0],s[1],s[2],220),t.rect(-this.halfW,0,this.canvasW,this.halfH),t.fill(),this.fill(t,140,180+Math.round(30*i),255,20),t.circle(0,this.halfH-140,140),t.fill(),this.stroke(t,e.isFever?255:90,e.isFever?220:140,e.isFever?80:220,70),t.lineWidth=1.2;for(var a=-2;a<=2;a++){var h=this.sx(.5*this.canvasW+36*a);t.moveTo(h,-this.halfH),t.lineTo(h,this.halfH)}t.stroke(),this.fill(t,28,28,36,240),t.rect(this.sx(0),-this.halfH,S,this.canvasH),t.fill(),t.rect(this.sx(this.canvasW-S),-this.halfH,S,this.canvasH),t.fill(),this.fill(t,70,90,120,120),t.rect(this.sx(S-2),-this.halfH,2,this.canvasH),t.fill(),t.rect(this.sx(this.canvasW-S),-this.halfH,2,this.canvasH),t.fill()},a.drawEntities=function(t,e){for(var s,n=i(e.trail);!(s=n()).done;){var a=s.value,h=Math.max(0,Math.min(1,a.life)),o=this.sx(a.x),r=this.sy(a.y+R);this.fill(t,a.isDashing||e.isFever?70:35,a.isDashing||e.isFever?200:45,a.isDashing||e.isFever?255:60,Math.round(120*h)),t.rect(o,r-R,R,R),t.fill()}for(var l,c=i(e.entities);!(l=c()).done;){var u=l.value;this.drawEntity(t,u)}for(var f,d=i(e.particles);!(f=d()).done;){var v=f.value;t.fillColor=this.cssColor(v.color,Math.max(0,Math.min(1,v.life/Math.max(1e-4,v.maxLife)))),t.circle(this.sx(v.x),this.sy(v.y),Math.max(1,v.size)),t.fill()}},a.drawEntity=function(t,e){var i=this.sx(e.x),s=this.sy(e.y+e.height);if("laser"===e.type){var n,a,h=this.sy(e.y+e.height),o=e.height;this.fill(t,230,70,80,220);var r=null!=(n=e.gapX)?n:0,l=null!=(a=e.gapWidth)?a:0;t.rect(this.sx(S),h,Math.max(0,r-S),o),t.fill();var c=r+l;return t.rect(this.sx(c),h,Math.max(0,this.canvasW-S-c),o),void t.fill()}if("coin"===e.type)return this.fill(t,245,170,24,235),t.circle(this.sx(e.x+.5*e.width),this.sy(e.y+.5*e.height),.5*e.width),t.fill(),this.fill(t,255,210,80,190),t.circle(this.sx(e.x+.5*e.width),this.sy(e.y+.5*e.height),.3*e.width),void t.fill();if("heart"===e.type){var u=this.sx(e.x+.5*e.width),f=this.sy(e.y+.5*e.height);return this.fill(t,235,68,90,235),t.circle(u-5,f+3,5),t.fill(),t.circle(u+5,f+3,5),t.fill(),t.moveTo(u-10,f+4),t.lineTo(u,f-10),t.lineTo(u+10,f+4),t.close(),void t.fill()}if("magnet"===e.type)return this.fill(t,170,85,247,220),t.rect(i,s,e.width,e.height),t.fill(),this.stroke(t,220,180,255,210),t.lineWidth=1.2,t.rect(i,s,e.width,e.height),void t.stroke();if("shield"===e.type)return this.fill(t,59,130,246,220),t.rect(i,s,e.width,e.height),t.fill(),this.stroke(t,170,210,255,210),t.lineWidth=1.2,t.rect(i,s,e.width,e.height),void t.stroke();if("spike"===e.type)return this.fill(t,239,68,68,235),"left"===e.side?(t.moveTo(i,s),t.lineTo(i+e.width,s+.5*e.height),t.lineTo(i,s+e.height)):(t.moveTo(i+e.width,s),t.lineTo(i,s+.5*e.height),t.lineTo(i+e.width,s+e.height)),t.close(),void t.fill();if("shuriken"===e.type){var d=this.sx(e.x+.5*e.width),v=this.sy(e.y+.5*e.height);return this.stroke(t,190,200,210,230),t.lineWidth=2,t.moveTo(d-10,v),t.lineTo(d+10,v),t.moveTo(d,v-10),t.lineTo(d,v+10),t.stroke(),this.fill(t,120,130,150,220),t.circle(d,v,3),void t.fill()}if("missile"===e.type)return this.fill(t,220,50,50,230),t.rect(i,s,e.width,e.height),t.fill(),this.fill(t,250,140,40,170),t.rect(i+3,s-6,e.width-6,6),void t.fill();this.fill(t,255,255,255,180),t.rect(i,s,e.width,e.height),t.fill()},a.drawNinja=function(t,e){var i=e.ninja;if("gameover"!==e.status){var s=this.sx(i.x),n=this.sy(i.y+i.yOffset+R);i.hasShield&&(this.fill(t,59,130,246,45),t.circle(this.sx(i.x+.5*R),this.sy(i.y+i.yOffset+.5*R),.9*R),t.fill(),this.stroke(t,110,180,255,160),t.lineWidth=1.5,t.circle(this.sx(i.x+.5*R),this.sy(i.y+i.yOffset+.5*R),.9*R),t.stroke()),(i.isDashing||e.isFever)&&(this.fill(t,e.isFever?250:40,e.isFever?220:210,e.isFever?80:255,60),t.rect(s-2,n-2,R+4,R+4),t.fill()),this.fill(t,17,24,39,i.invincibleTimer>0?150:240),t.rect(s,n,R,R),t.fill(),this.fill(t,239,68,68,240),t.rect(s,n+R-12,R,6),t.fill(),this.fill(t,239,68,68,220),"left"===i.side?(t.moveTo(s+R,n+R-8),t.lineTo(s+R+10,n+R-4),t.lineTo(s+R+2,n+R-14)):(t.moveTo(s,n+R-8),t.lineTo(s-10,n+R-4),t.lineTo(s-2,n+R-14)),t.close(),t.fill(),this.fill(t,255,255,255,245),"right"===i.side?(t.rect(s+2,n+R-18,4,4),t.fill(),t.rect(s+10,n+R-18,4,4),t.fill()):(t.rect(s+R-6,n+R-18,4,4),t.fill(),t.rect(s+R-14,n+R-18,4,4),t.fill())}},a.drawUiBars=function(t,e){this.fill(t,10,12,18,175),t.rect(10-this.halfW,this.halfH-74,this.canvasW-20,64),t.fill(),this.stroke(t,80,120,180,120),t.lineWidth=1.4,t.rect(10-this.halfW,this.halfH-74,this.canvasW-20,64),t.stroke();var i=S+10;this.fill(t,0,0,0,140),t.rect(this.sx(i),this.sy(50),112,8),t.fill();var s=Math.max(0,Math.min(1,e.ninja.energy/L)),n=[6,182,212];e.ninja.energy<=30?n=[239,68,68]:e.ninja.energy<=80&&(n=[52,211,153]),this.fill(t,n[0],n[1],n[2],240),t.rect(this.sx(i),this.sy(50),112*s,8),t.fill();for(var a=0;a<C;a++){var h=this.canvasW-S-20-26*(C-a);a<e.ninja.health?this.fill(t,239,68,68,235):this.fill(t,100,110,130,120);var o=this.sx(h+10),r=this.sy(36);t.circle(o-4,r+2,4),t.fill(),t.circle(o+4,r+2,4),t.fill(),t.moveTo(o-8,r+2),t.lineTo(o,r-8),t.lineTo(o+8,r+2),t.close(),t.fill()}var l=e.isFever?Math.max(0,Math.min(1,e.feverTimer/5e3)):Math.max(0,Math.min(1,e.combo/E));this.fill(t,0,0,0,140),t.rect(this.sx(this.canvasW-S-10-76),this.sy(96),76,6),t.fill();var c=e.isFever||e.combo>=E-3?[253,224,71]:[56,189,248];this.fill(t,c[0],c[1],c[2],240),t.rect(this.sx(this.canvasW-S-10-76),this.sy(96),76*l,6),t.fill()},a.drawMenuOverlay=function(t,e){this.fill(t,0,0,0,204),t.rect(-this.halfW,-this.halfH,this.canvasW,this.canvasH),t.fill();var i=.5*this.canvasW,n=this.canvasH,a=Math.min(320,this.canvasW-44),h=i-.5*a,o=.34*n,r=Math.max(.38*n,292),l=.16*n,c=Math.min(.79*n,o+r+72);this.fill(t,239,68,68,24),this.fillRoundedRect(t,i-180,l-26,360,56,28),this.fill(t,255,255,255,14),this.fillRoundedRect(t,h,o,a,r,24),this.stroke(t,255,255,255,40),t.lineWidth=1.4,this.strokeRoundedRect(t,h,o,a,r,24),this.fill(t,255,255,255,10),this.fillRoundedRect(t,h+1,o+1,a-2,48,22);for(var u=[[245,158,11],[34,211,238],[168,85,247],[239,68,68]],m=o+56,T=o+r-42,x=Math.max(44,Math.min(60,(T-m)/3)),f=0;f<4;f++){var d=m+x*f,v=u[f];this.fill(t,v[0],v[1],v[2],38),this.fillRoundedRect(t,h+16,d,28,28,10),this.stroke(t,v[0],v[1],v[2],120),t.lineWidth=1.2,this.strokeRoundedRect(t,h+16,d,28,28,10)}var p=300,g=i-150,y=c;this.fill(t,255,255,255,246),this.fillRoundedRect(t,g,y,p,56,28),this.fill(t,245,245,245,160),this.fillRoundedRect(t,g+2,y+2,296,24,20),this.stroke(t,255,255,255,255),t.lineWidth=1.8,this.strokeRoundedRect(t,g,y,p,56,28),this.activeButtons.push({id:"start",x:g,y:y,w:p,h:56}),this.drawNinja(t,s({},e,{ninja:s({},e.ninja,{x:i-.5*R,y:.3*n,yOffset:0,side:"right",vx:0,isDashing:!1,invincibleTimer:0})}))},a.drawGameOverOverlay=function(t,e){this.fill(t,0,0,0,204),t.rect(-this.halfW,-this.halfH,this.canvasW,this.canvasH),t.fill();var i=this.canvasH,s=300,n=.5*this.canvasW-150,a=.31*i,h=.29*i;this.fill(t,255,255,255,14),this.fillRoundedRect(t,n,a,s,h,24),this.stroke(t,255,255,255,32),t.lineWidth=1.3,this.strokeRoundedRect(t,n,a,s,h,24),Math.floor(e.score)>0&&Math.floor(e.score)>=this.bestScore&&(this.fill(t,214,158,32,160),this.fillRoundedRect(t,n,a,s,22,11));var o=a+h-56;this.fill(t,250,204,21,22),this.fillRoundedRect(t,n+34,o,232,42,16),this.stroke(t,250,204,21,60),t.lineWidth=1.2,this.strokeRoundedRect(t,n+34,o,232,42,16);var r=s,l=n,c=.66*i,u=c+56+16;this.fill(t,255,255,255,246),this.fillRoundedRect(t,l,c,r,56,28),this.stroke(t,255,255,255,255),t.lineWidth=1.8,this.strokeRoundedRect(t,l,c,r,56,28),this.activeButtons.push({id:"restart",x:l,y:c,w:r,h:56}),this.fill(t,255,255,255,26),this.fillRoundedRect(t,l,u,r,48,24),this.stroke(t,255,255,255,44),t.lineWidth=1.4,this.strokeRoundedRect(t,l,u,r,48,24),this.activeButtons.push({id:"home",x:l,y:u,w:r,h:48})},a.fillRoundedRect=function(t,e,i,s,n,a){this.roundedRectPath(t,e,i,s,n,a),t.fill()},a.strokeRoundedRect=function(t,e,i,s,n,a){this.roundedRectPath(t,e,i,s,n,a),t.stroke()},a.roundedRectPath=function(t,e,i,s,n,a){var h=Math.max(0,Math.min(a,.5*Math.min(s,n))),o=this.sx(e),r=this.sy(i+n),l=t;"function"!=typeof l.roundRect?t.rect(o,r,s,n):l.roundRect(o,r,s,n,h)},a.updateLabels=function(t,e){for(var i=this,s=function(t,e,s,n,a,o,r,l){if(t){var c,u,f=t.node.getComponent(h);if(f)f.setAnchorPoint(null!=(c=null==l?void 0:l.ax)?c:.5,null!=(u=null==l?void 0:l.ay)?u:.5),f.setContentSize(n,a);null!=l&&l.fontSize&&(t.fontSize=l.fontSize,t.lineHeight=Math.round(1.2*l.fontSize)),void 0!==(null==l?void 0:l.hAlign)&&(t.horizontalAlign=l.hAlign),void 0!==(null==l?void 0:l.vAlign)&&(t.verticalAlign=l.vAlign),t.node.setPosition(i.sx(e),i.sy(s),0),t.string=o,t.color=r}},n=0,a=[this.titleLabel,this.subLabel,this.primaryBtnLabel,this.secondaryBtnLabel,this.tertiaryBtnLabel,this.centerBannerLabel,this.scoreLabel,this.hudLeftLabel,this.hudRightLabel];n<a.length;n++){var o=a[n];o&&(o.string="")}if("menu"===e){var r=.5*this.canvasW,l=this.canvasH,u=r-.5*Math.min(320,this.canvasW-44)+54,f=.16*l,v=f+50,p=.34*l,g=Math.max(.38*l,292),y=p+56,m=p+g-42,T=Math.max(44,Math.min(60,(m-y)/3)),x=Math.min(.79*l,p+g+72);s(this.titleLabel,r,f,this.canvasW-60,72,"忍者突袭",new d(255,174,72,255),{fontSize:46}),s(this.subLabel,r,v,this.canvasW-120,24,"点击切换方向，按住进入冲刺",new d(248,113,113,225),{fontSize:14}),s(this.centerBannerLabel,r,p+24,220,26,"操作说明",new d(235,240,248,235),{fontSize:18}),s(this.scoreLabel,u,y+14,this.canvasW-120,40,"点击切换左右\n可在空中即时反向",new d(236,240,248,235),{ax:0,ay:.5,hAlign:c.LEFT,fontSize:13}),s(this.hudLeftLabel,u,y+14+T,this.canvasW-120,40,"按住冲刺\n冲刺期间无敌并消耗能量",new d(236,240,248,235),{ax:0,ay:.5,hAlign:c.LEFT,fontSize:13}),s(this.hudRightLabel,u,y+14+2*T,this.canvasW-120,40,"道具效果\n磁铁、护盾与生命回复",new d(236,240,248,235),{ax:0,ay:.5,hAlign:c.LEFT,fontSize:13}),s(this.secondaryBtnLabel,u,y+14+3*T,this.canvasW-120,40,"狂热模式\n连击达到 15 次触发",new d(236,240,248,235),{ax:0,ay:.5,hAlign:c.LEFT,fontSize:13}),s(this.primaryBtnLabel,r,x+28,300,44,"开始游戏",new d(18,18,22,255),{fontSize:22})}else if("gameover"===e){var y=Math.floor(t.score)>0&&Math.floor(t.score)>=this.bestScore,m=.5*this.canvasW,T=this.canvasH,x=.31*T,D=.29*T,F=x+D-35,b=.66*T;s(this.titleLabel,m,.23*T,this.canvasW-80,64,"\u6e38\u620f\u7ed3\u675f",new d(248,113,113,255),{fontSize:42}),y&&s(this.tertiaryBtnLabel,m,x+12,220,20,"\u65b0\u7eaa\u5f55",new d(255,244,200,240),{fontSize:11}),s(this.subLabel,m,x+64,200,20,"\u5f97\u5206",new d(255,255,255,150),{fontSize:12}),s(this.scoreLabel,m,x+114,240,60,""+Math.floor(t.score),new d(255,255,255,255),{fontSize:52}),s(this.hudLeftLabel,m,F,232,30,"\u6700\u9ad8\u5206 "+this.bestScore,new d(250,204,21,240),{fontSize:16}),s(this.primaryBtnLabel,m,b+28,300,44,"\u518d\u6765\u4e00\u5c40",new d(18,18,22,255),{fontSize:20}),s(this.secondaryBtnLabel,m,b+96,300,40,"\u8fd4\u56de\u4e3b\u83dc\u5355",new d(235,240,248,245),{fontSize:16})}},n}(b))||H);n._RF.pop()}}}));

System.register("chunks:///_virtual/Renderer.ts",["cc","./constants.ts"],(function(t){var l,e,i,h,a,o;return{setters:[function(t){l=t.cclegacy},function(t){e=t.WALL_WIDTH,i=t.NINJA_SIZE,h=t.MAX_HEALTH,a=t.FEVER_COMBO_THRESHOLD,o=t.ENERGY_MAX}],execute:function(){l._RF.push({},"39fab0r8zRBy70/aMGKo6Mc","Renderer",void 0);t("GameRenderer",function(){function t(t){this.ctx=void 0,this.ctx=t}var l=t.prototype;return l.drawHeartShape=function(t,l){t.beginPath(),t.arc(-l/4,-l/4,l/4,Math.PI,0,!1),t.arc(l/4,-l/4,l/4,Math.PI,0,!1),t.lineTo(0,l/2),t.closePath()},l.draw=function(t){var l=this,r=this.ctx,f=t.width,n=t.height,s=t.bgOffset,g=t.entities,c=t.trail,d=t.particles,y=t.floatingTexts,w=t.ninja,S=t.score,F=t.combo,v=t.shakeIntensity,T=t.bgHue,b=t.isFever;if(r.save(),v>0){var M=(Math.random()-.5)*v,P=(Math.random()-.5)*v;r.translate(M,P)}if(b){var R=Date.now()/5%360;r.fillStyle="hsl("+R+", 80%, 15%)"}else r.fillStyle="hsl("+T+", 30%, 8%)";if(r.fillRect(0,0,f,n),w.isDashing||b){var p=b?"hsla("+Date.now()/5%360+", 100%, 80%, 0.4)":"hsla("+T+", 100%, 80%, 0.3)";r.strokeStyle=p,r.lineWidth=2,r.beginPath();for(var x=0;x<20;x++){var D=Math.random()*f,u=Math.random()*n,m=50+200*Math.random();r.moveTo(D,u),r.lineTo(D,u+m)}r.stroke()}r.fillStyle=b?"hsl("+Date.now()/5%360+", 60%, 25%)":"hsl("+T+", 40%, 15%)",r.globalAlpha=.5;for(var A=0;A<n/100+2;A++){var E=(100*A+s)%(n+100)-100;r.fillRect(f/2-1,E,2,40)}r.globalAlpha=1;var I=b?"hsl("+Date.now()/5%360+", 40%, 20%)":"hsl("+T+", 20%, 20%)";if(r.fillStyle=I,r.fillRect(0,0,e,n),r.fillRect(f-e,0,e,n),r.fillStyle=b?"hsl("+Date.now()/5%360+", 50%, 30%)":"hsl("+T+", 30%, 30%)",r.fillRect(e-2,0,2,n),r.fillRect(f-e,0,2,n),g.forEach((function(t){if(r.save(),"laser"===t.type){r.translate(0,t.y+t.height/2),r.shadowColor="#EF4444",r.shadowBlur=15,r.fillStyle="#EF4444",r.fillRect(e,-t.height/2,(t.gapX||0)-e,t.height);var i=(t.gapX||0)+(t.gapWidth||0);r.fillRect(i,-t.height/2,f-e-i,t.height),r.fillStyle="#FFFFFF",r.shadowBlur=0,r.fillRect(e,-t.height/4,(t.gapX||0)-e,t.height/2),r.fillRect(i,-t.height/4,f-e-i,t.height/2)}else if(r.translate(t.x+t.width/2,t.y+t.height/2),"spike"===t.type)r.fillStyle="#EF4444",r.beginPath(),"left"===t.side?(r.moveTo(-t.width/2,-t.height/2),r.lineTo(t.width/2,0),r.lineTo(-t.width/2,t.height/2)):(r.moveTo(t.width/2,-t.height/2),r.lineTo(-t.width/2,0),r.lineTo(t.width/2,t.height/2)),r.fill(),r.fillStyle="#FCA5A5",r.beginPath(),"left"===t.side?(r.moveTo(-t.width/2,0),r.lineTo(t.width/2,0),r.lineTo(-t.width/2,t.height/2)):(r.moveTo(t.width/2,0),r.lineTo(-t.width/2,0),r.lineTo(t.width/2,t.height/2)),r.fill();else if("shuriken"===t.type){r.rotate(t.rotation),r.fillStyle="#9CA3AF",r.beginPath();for(var h=0;h<4;h++)r.lineTo(0,-t.height/2),r.lineTo(t.width/6,-t.height/6),r.rotate(Math.PI/2);r.closePath(),r.fill(),r.fillStyle="hsl("+T+", 30%, 8%)",r.beginPath(),r.arc(0,0,t.width/6,0,2*Math.PI),r.fill()}else if("missile"===t.type)r.rotate(t.rotation),r.fillStyle="#F97316",r.beginPath(),r.moveTo(-t.width/3,t.height/2),r.lineTo(0,t.height/2+15+10*Math.random()),r.lineTo(t.width/3,t.height/2),r.fill(),r.fillStyle="#DC2626",r.fillRect(-t.width/2,-t.height/4,t.width,.75*t.height),r.fillStyle="#9CA3AF",r.beginPath(),r.moveTo(-t.width/2,-t.height/4),r.lineTo(0,-t.height/2),r.lineTo(t.width/2,-t.height/4),r.fill();else if("coin"===t.type){var a=Math.abs(Math.cos(t.rotation));r.scale(a,1),r.fillStyle="#F59E0B",r.beginPath(),r.arc(0,0,t.width/2,0,2*Math.PI),r.fill(),r.fillStyle="#FBBF24",r.beginPath(),r.arc(0,0,t.width/3,0,2*Math.PI),r.fill(),r.fillStyle="#B45309",r.fillRect(-t.width/6,-t.height/6,t.width/3,t.height/3)}else if("heart"===t.type){var o=1+.1*Math.sin(Date.now()/150);r.scale(o,o),r.fillStyle="#EF4444",l.drawHeartShape(r,t.width),r.fill(),r.fillStyle="rgba(255,255,255,0.4)",r.beginPath(),r.arc(-t.width/8,-t.width/4,t.width/8,0,2*Math.PI),r.fill()}else if("magnet"===t.type){var n=1+.1*Math.sin(Date.now()/200);r.scale(n,n),r.fillStyle="#EF4444",r.beginPath(),r.arc(0,0,t.width/2,Math.PI,0),r.lineTo(t.width/2,t.height/3),r.lineTo(t.width/4,t.height/3),r.lineTo(t.width/4,0),r.arc(0,0,t.width/4,0,Math.PI,!0),r.lineTo(-t.width/4,t.height/3),r.lineTo(-t.width/2,t.height/3),r.closePath(),r.fill(),r.fillStyle="#D1D5DB",r.fillRect(-t.width/2,t.height/3,t.width/4,t.height/6),r.fillRect(t.width/4,t.height/3,t.width/4,t.height/6)}else if("shield"===t.type){var s=1+.1*Math.sin(Date.now()/200);r.scale(s,s),r.fillStyle="#3B82F6",r.beginPath();for(var g=0;g<6;g++)r.lineTo(Math.cos(g*Math.PI/3)*t.width/2,Math.sin(g*Math.PI/3)*t.width/2);r.closePath(),r.fill(),r.fillStyle="#93C5FD",r.beginPath();for(var c=0;c<6;c++)r.lineTo(Math.cos(c*Math.PI/3)*t.width/4,Math.sin(c*Math.PI/3)*t.width/4);r.closePath(),r.fill()}r.restore()})),c.forEach((function(t){r.save(),r.globalAlpha=t.life*(t.isDashing||b?.6:.3),r.translate(t.x+i/2,t.y+i/2),t.isDashing||b?(r.fillStyle=b?"#FDE047":"#06B6D4",r.fillRect(-i/2-2,-i/2-2,i+4,i+4)):(r.fillStyle="#1F2937",r.fillRect(-i/2,-i/2,i,i)),r.restore()})),r.globalAlpha=1,d.forEach((function(t){r.globalAlpha=t.life/t.maxLife,r.fillStyle=t.color,r.beginPath(),r.arc(t.x,t.y,t.size,0,2*Math.PI),r.fill()})),r.globalAlpha=1,"gameover"!==t.status){if(r.save(),w.invincibleTimer>0&&Math.floor(Date.now()/100)%2==0&&(r.globalAlpha=.3),r.translate(w.x+i/2,w.y+w.yOffset+i/2),w.magnetTimer>0&&(r.strokeStyle="rgba(168, 85, 247, "+(.5+.3*Math.sin(Date.now()/100))+")",r.lineWidth=3,r.beginPath(),r.arc(0,0,i,0,2*Math.PI),r.stroke()),w.hasShield&&(r.fillStyle="rgba(59, 130, 246, 0.3)",r.strokeStyle="#3B82F6",r.lineWidth=2,r.beginPath(),r.arc(0,0,.8*i,0,2*Math.PI),r.fill(),r.stroke()),w.isDashing||b){var B=b?"#FDE047":"#06B6D4";r.shadowColor=B,r.shadowBlur=15,r.fillStyle=B,r.fillRect(-i/2-2,-i/2-2,i+4,i+4),r.shadowBlur=0}r.fillStyle="#111827",r.fillRect(-i/2,-i/2,i,i),r.fillStyle="#EF4444",r.fillRect(-i/2,-i/2+6,i,6),r.beginPath(),w.vx<0||0===w.vx&&"left"===w.side?(r.moveTo(i/2,-i/2+6),r.lineTo(i/2+10,-i/2-5+5*Math.sin(Date.now()/100)),r.lineTo(i/2,-i/2+12)):(r.moveTo(-i/2,-i/2+6),r.lineTo(-i/2-10,-i/2-5+5*Math.sin(Date.now()/100)),r.lineTo(-i/2,-i/2+12)),r.fill(),r.fillStyle="#FFFFFF",w.vx>0||0===w.vx&&"right"===w.side?(r.fillRect(2,-i/2+14,4,4),r.fillRect(10,-i/2+14,4,4)):(r.fillRect(-6,-i/2+14,4,4),r.fillRect(-14,-i/2+14,4,4)),r.restore()}y.forEach((function(t){r.save(),r.globalAlpha=t.life,r.fillStyle=t.color,r.font="bold "+20*t.scale+"px Inter, sans-serif",r.textAlign="center",r.strokeStyle="#000000",r.lineWidth=3,r.strokeText(t.text,t.x,t.y),r.fillText(t.text,t.x,t.y),r.restore()})),r.globalAlpha=1,b&&(r.strokeStyle="hsla("+Date.now()/5%360+", 100%, 50%, 0.8)",r.lineWidth=10,r.strokeRect(0,0,f,n)),r.fillStyle="#FFFFFF",r.font="bold 36px Inter, sans-serif",r.textAlign="center",r.shadowColor="rgba(0,0,0,0.5)",r.shadowBlur=4,r.shadowOffsetY=2,r.fillText(Math.floor(S).toString(),f/2,60),r.shadowBlur=0,r.shadowOffsetY=0;for(var k=0;k<h;k++){var H=f-e-10-28*(h-k);r.save(),r.translate(H+10,30),k<w.health?(r.fillStyle="#EF4444",this.drawHeartShape(r,20),r.fill()):(r.strokeStyle="rgba(255, 255, 255, 0.3)",r.lineWidth=2,this.drawHeartShape(r,20),r.stroke()),r.restore()}if(b){r.fillStyle="#FDE047",r.font="bold 24px Inter, sans-serif",r.textAlign="right",r.fillText("狂热模式!",f-e-10,80);var C=100;r.fillStyle="rgba(0,0,0,0.5)",r.fillRect(f-e-10-C,90,C,6),r.fillStyle="#FDE047",r.fillRect(f-e-10-C,90,C*(t.feverTimer/5e3),6)}else{r.fillStyle="#38BDF8",r.font="bold 24px Inter, sans-serif",r.textAlign="right",r.fillText("连击 x"+F,f-e-10,80);r.fillStyle="rgba(0,0,0,0.5)",r.fillRect(f-e-10-60,90,60,6),r.fillStyle=F>=a-3?"#FDE047":"#38BDF8",r.fillRect(f-e-10-60,90,F/a*60,6)}var W=e+10;r.fillStyle="rgba(0,0,0,0.5)",r.fillRect(W,40,100,8),w.energy>80?r.fillStyle="#06B6D4":w.energy>30?r.fillStyle="#34D399":r.fillStyle="#EF4444",r.fillRect(W,40,w.energy/o*100,8),r.fillStyle="#FFFFFF",r.font="bold 12px Inter, sans-serif",r.textAlign="left",r.fillText("能量",W,35),r.restore()},t}());l._RF.pop()}}}));

System.register("chunks:///_virtual/types.ts",["cc"],(function(){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"842c4HadtlB+I1OUr0s4L0a","types",void 0),t._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});